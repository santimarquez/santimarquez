---
interface Props {
  t: (key: string) => string;
  successMessage: string;
  errorMessage: string;
}

const { t, successMessage, errorMessage } = Astro.props;
---

<div id="contact-form-container" class="max-w-2xl" data-contact-success-msg={successMessage} data-contact-error-msg={errorMessage}>
  <form id="contact-form" class="space-y-6" aria-label={t('contact.title')}>
    <div class="grid gap-6 sm:grid-cols-2">
      <div>
        <label for="contact-name" class="block text-xs font-medium uppercase tracking-wider text-charcoal dark:text-slate-300">{t('contact.name')}</label>
        <input type="text" id="contact-name" name="name" required autocomplete="name" placeholder={t('contact.namePlaceholder')} class="mt-2 block w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-charcoal placeholder:text-charcoal-light focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-500" />
        <span id="contact-name-error" class="mt-1 hidden text-sm text-red-600 dark:text-red-400" aria-live="polite"></span>
      </div>
      <div>
        <label for="contact-email" class="block text-xs font-medium uppercase tracking-wider text-charcoal dark:text-slate-300">{t('contact.email')}</label>
        <input type="email" id="contact-email" name="email" required autocomplete="email" placeholder={t('contact.emailPlaceholder')} class="mt-2 block w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-charcoal placeholder:text-charcoal-light focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-500" />
        <span id="contact-email-error" class="mt-1 hidden text-sm text-red-600 dark:text-red-400" aria-live="polite"></span>
      </div>
    </div>
    <div>
      <label for="contact-message" class="block text-xs font-medium uppercase tracking-wider text-charcoal dark:text-slate-300">{t('contact.message')}</label>
      <textarea id="contact-message" name="message" required rows="4" placeholder={t('contact.messagePlaceholder')} class="mt-2 block w-full rounded-lg border border-slate-300 bg-white px-4 py-3 text-charcoal placeholder:text-charcoal-light focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-500"></textarea>
      <span id="contact-message-error" class="mt-1 hidden text-sm text-red-600 dark:text-red-400" aria-live="polite"></span>
    </div>
    <button type="submit" class="inline-flex items-center gap-2 rounded-lg bg-charcoal px-6 py-3 text-sm font-medium uppercase tracking-wider text-white shadow-sm transition hover:bg-charcoal-light focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 dark:bg-slate-100 dark:text-charcoal dark:hover:bg-slate-200">
      {t('contact.send')}
      <span aria-hidden="true">â†’</span>
    </button>
  </form>
  <div id="contact-success" class="hidden rounded-lg border border-green-200 bg-green-50 p-4 text-green-800 dark:border-green-800 dark:bg-green-900/30 dark:text-green-200" role="status" aria-live="polite"></div>
  <div id="contact-error" class="hidden rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800 dark:border-red-800 dark:bg-red-900/30 dark:text-red-200" role="alert"></div>
</div>
<script>
  import { animate } from 'motion';

  const form = document.getElementById('contact-form') as HTMLFormElement;
  const container = document.getElementById('contact-form-container');
  const successEl = document.getElementById('contact-success');
  const errorEl = document.getElementById('contact-error');

  function showSuccess(message: string) {
    if (!successEl || !container) return;
    form?.classList.add('hidden');
    errorEl?.classList.add('hidden');
    successEl.textContent = message;
    successEl.classList.remove('hidden');
    animate(successEl, { opacity: [0, 1], scale: [0.98, 1] }, { duration: 0.3, ease: 'easeOut' });
  }

  function showError(message: string) {
    if (!errorEl) return;
    errorEl.textContent = message;
    errorEl.classList.remove('hidden');
    animate(errorEl, { opacity: [0, 1] }, { duration: 0.2 });
  }

  function clearFieldErrors() {
    ['name', 'email', 'message'].forEach((f) => {
      const err = document.getElementById(`contact-${f}-error`);
      if (err) {
        err.classList.add('hidden');
        err.textContent = '';
      }
    });
  }

  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    clearFieldErrors();
    errorEl?.classList.add('hidden');

    const name = (form.querySelector('#contact-name') as HTMLInputElement)?.value?.trim();
    const email = (form.querySelector('#contact-email') as HTMLInputElement)?.value?.trim();
    const message = (form.querySelector('#contact-message') as HTMLTextAreaElement)?.value?.trim();

    let valid = true;
    if (!name) {
      const el = document.getElementById('contact-name-error');
      if (el) { el.textContent = 'Name is required'; el.classList.remove('hidden'); }
      valid = false;
    }
    if (!email) {
      const el = document.getElementById('contact-email-error');
      if (el) { el.textContent = 'Email is required'; el.classList.remove('hidden'); }
      valid = false;
    }
    if (!message) {
      const el = document.getElementById('contact-message-error');
      if (el) { el.textContent = 'Message is required'; el.classList.remove('hidden'); }
      valid = false;
    }

    if (!valid) {
      showError(container?.dataset?.contactErrorMsg ?? 'Please fill all fields correctly.');
      return;
    }
    const successMsg = container?.dataset?.contactSuccessMsg ?? 'Message sent. I\'ll get back to you soon.';
    showSuccess(successMsg);
  });
</script>
